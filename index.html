<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice AI Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-focus:focus { outline: none; border-color: #6366f1; ring: 2px; ring-color: rgba(99, 102, 241, 0.2); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden">

    <!-- Background Gradients -->
    <div class="absolute top-0 left-0 w-96 h-96 bg-indigo-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 -translate-x-1/2 -translate-y-1/2 animate-blob"></div>
    <div class="absolute bottom-0 right-0 w-96 h-96 bg-purple-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 translate-x-1/2 translate-y-1/2 animate-blob animation-delay-2000"></div>

    <div class="w-full max-w-md glass-panel rounded-2xl p-6 shadow-2xl z-10 relative">
        
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-wave-square text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-white tracking-tight">Voice AI Studio</h1>
                    <p class="text-xs text-slate-400">Generative Audio Engine</p>
                </div>
            </div>
            <div class="h-2 w-2 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"></div>
        </div>

        <!-- Error Banner -->
        <div id="errorMsg" class="hidden mb-4 bg-red-500/10 border border-red-500/50 text-red-200 px-4 py-3 rounded-lg text-sm flex items-start gap-3">
            <i class="fa-solid fa-circle-exclamation mt-0.5 text-red-500"></i>
            <span id="errorText">Something went wrong</span>
        </div>

        <!-- Main Content -->
        <div class="space-y-5">
            
            <!-- Script Input -->
            <div class="space-y-2">
                <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1">Script</label>
                <div class="relative group">
                    <textarea id="scriptInput" 
                        class="w-full h-32 bg-slate-800/50 border border-slate-700 rounded-xl p-4 text-sm text-slate-200 placeholder-slate-500 resize-none input-focus transition-all duration-300 group-hover:bg-slate-800/80"
                        placeholder="Type something amazing for the AI to say..."></textarea>
                    <div class="absolute bottom-3 right-3 text-xs text-slate-500 pointer-events-none">
                        <i class="fa-solid fa-keyboard mr-1"></i>Text
                    </div>
                </div>
            </div>

            <!-- Voice Selection -->
            <div class="space-y-2">
                <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1">Voice Model</label>
                <div class="relative">
                    <select id="voiceSelect" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl p-3 pl-4 pr-10 text-sm text-slate-200 appearance-none input-focus cursor-pointer transition-all hover:bg-slate-800/80">
                        <option value="Zephyr">Zephyr (Bright & Balanced)</option>
                        <option value="Puck">Puck (Energetic)</option>
                        <option value="Charon">Charon (Deep & Authoritative)</option>
                        <option value="Kore">Kore (Calm & Soothing)</option>
                        <option value="Fenrir">Fenrir (Intense)</option>
                        <option value="Aoede">Aoede (Soft & Gentle)</option>
                    </select>
                    <div class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none">
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

             <!-- Tone/Style Input -->
             <div class="space-y-2">
                <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider ml-1">Tone & Style</label>
                <input id="accentPrompt" type="text" 
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-xl p-3 text-sm text-slate-200 placeholder-slate-500 input-focus transition-all hover:bg-slate-800/80"
                    placeholder="e.g. Whisper, Excited, News Anchor...">
            </div>

            <!-- Generate Button -->
            <button id="generateBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-medium py-3.5 rounded-xl shadow-lg shadow-indigo-500/20 transform transition-all duration-200 active:scale-[0.98] flex items-center justify-center gap-2 group">
                <i id="btnIcon" class="fa-solid fa-wand-magic-sparkles group-hover:rotate-12 transition-transform"></i>
                <span id="btnText">Generate Audio</span>
                <div id="btnSpinner" class="hidden h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
            </button>

            <!-- Audio Player (Hidden initially) -->
            <div id="audioPlayerContainer" class="hidden pt-2 animate-fade-in">
                <div class="bg-slate-800/80 rounded-xl p-4 border border-slate-700/50">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xs font-medium text-indigo-400">Generated Audio</span>
                        <a id="downloadBtn" href="#" download="voice-ai-audio.wav" class="text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1">
                            <i class="fa-solid fa-download"></i> Save
                        </a>
                    </div>
                    <audio id="audioPlayer" controls class="w-full h-8 custom-audio" style="filter: invert(1) hue-rotate(180deg);"></audio>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- APP LOGIC ---
        // TRANSCRIBED DIRECTLY FROM YOUR SCREENSHOT:
        const apiKey = "AIzaSyCerMGwBZv3MDgYKPlgK4lgLgo30auXUXM"; 
        
        let currentAudioUrl = null;

        const els = {
            script: document.getElementById('scriptInput'),
            voice: document.getElementById('voiceSelect'),
            tone: document.getElementById('accentPrompt'),
            btn: document.getElementById('generateBtn'),
            btnText: document.getElementById('btnText'),
            btnIcon: document.getElementById('btnIcon'),
            btnSpinner: document.getElementById('btnSpinner'),
            playerContainer: document.getElementById('audioPlayerContainer'),
            player: document.getElementById('audioPlayer'),
            download: document.getElementById('downloadBtn'),
            errorBox: document.getElementById('errorMsg'),
            errorText: document.getElementById('errorText')
        };

        // --- WAV CONVERTER HELPER ---
        function pcmToWav(pcmData) {
            const numChannels = 1;
            const sampleRate = 24000;
            const bitDepth = 16;
            
            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = pcmData.length;
            const bufferSize = 44 + dataSize;
            
            const buffer = new ArrayBuffer(bufferSize);
            const view = new DataView(buffer);
            
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataSize, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitDepth, true);
            writeString(view, 36, 'data');
            view.setUint32(40, dataSize, true);
            
            const pcmBytes = new Uint8Array(pcmData);
            const wavBytes = new Uint8Array(buffer);
            wavBytes.set(pcmBytes, 44);
            
            return buffer;
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        const setLoading = (isLoading) => {
            els.btn.disabled = isLoading;
            if (isLoading) {
                els.btn.classList.add('opacity-75', 'cursor-not-allowed');
                els.btnText.textContent = "Processing...";
                els.btnIcon.classList.add('hidden');
                els.btnSpinner.classList.remove('hidden');
                els.errorBox.classList.add('hidden');
            } else {
                els.btn.classList.remove('opacity-75', 'cursor-not-allowed');
                els.btnText.textContent = "Generate Audio";
                els.btnIcon.classList.remove('hidden');
                els.btnSpinner.classList.add('hidden');
            }
        };

        const showError = (msg) => {
            console.error(msg);
            els.errorText.textContent = msg;
            els.errorBox.classList.remove('hidden');
            els.errorBox.classList.add('animate-pulse');
            setTimeout(() => els.errorBox.classList.remove('animate-pulse'), 500);
            alert("Error: " + msg);
        };

        els.btn.addEventListener('click', async () => {
            const text = els.script.value.trim();
            const voiceName = els.voice.value;
            const style = els.tone.value.trim();

            if (!text) return showError("Please enter some text first!");
            if (!apiKey || apiKey.includes("PASTE")) return showError("API Key is missing!");

            setLoading(true);
            els.playerContainer.classList.add('hidden');

            try {
                const userPrompt = `Say the following text: "${text}". \n\nStyle instructions: Use a ${voiceName} voice. ${style ? "Tone: " + style : ""}`;

                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: userPrompt }]
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                prebuiltVoiceConfig: {
                                    voiceName: voiceName
                                }
                            }
                        }
                    }
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (!response.ok) {
                    const errorDetails = data.error ? data.error.message : "Unknown API Error";
                    throw new Error(`Google API Error (${response.status}): ${errorDetails}`);
                }

                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0].inlineData) {
                    const audioBase64 = data.candidates[0].content.parts[0].inlineData.data;
                    
                    const binaryString = atob(audioBase64);
                    const len = binaryString.length;
                    const bytes = new Uint8Array(len);
                    for (let i = 0; i < len; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }
                    
                    const wavBuffer = pcmToWav(bytes);
                    const blob = new Blob([wavBuffer], { type: 'audio/wav' });
                    
                    if (currentAudioUrl) URL.revokeObjectURL(currentAudioUrl);
                    currentAudioUrl = URL.createObjectURL(blob);

                    els.player.src = currentAudioUrl;
                    els.download.href = currentAudioUrl;
                    els.playerContainer.classList.remove('hidden');
                    
                    try {
                        await els.player.play();
                    } catch (e) {
                        console.log("Auto-play blocked, user must click play");
                    }
                } else {
                    throw new Error("No audio data received. Try a shorter script.");
                }

            } catch (error) {
                showError(error.message);
            } finally {
                setLoading(false);
            }
        });

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes blob { 0% { transform: translate(0px, 0px) scale(1); } 33% { transform: translate(30px, -50px) scale(1.1); } 66% { transform: translate(-20px, 20px) scale(0.9); } 100% { transform: translate(0px, 0px) scale(1); } }
            .animate-blob { animation: blob 7s infinite; }
            .animation-delay-2000 { animation-delay: 2s; }
            .animate-fade-in { animation: fadeIn 0.5s ease-out; }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        `;
        document.head.appendChild(styleSheet);
    </script>
</body>
</html>


